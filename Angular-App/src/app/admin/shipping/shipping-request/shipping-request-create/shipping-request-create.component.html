<p-dialog [closeOnEscape]="true" [position]="'right'" [header]="titleDialog" styleClass="p-fluid w-83" [modal]="true" [(visible)]="isShowDialog" (onHide)="hideDialog()">
  <ng-template pTemplate="content">
    <p-steps [model]="stepItems" [activeIndex]="stepIndex"></p-steps>

    <ng-container *ngIf="stepIndex === 0">
      <p-card>
        <ng-template pTemplate="content">
          <div class="p-field">
            <label for="shippingInfos">Shipping Date and Shipping Informations <span class="p-invalid"> *</span></label>

            <p-dropdown
              [options]="selecteShippingInfoItems"
              [(ngModel)]="selectedShippingInfo"
              defaultLabel="Shipping Date and Shipping Informations"
              placeholder="Please select Shipping Date and Shipping Informations"
              appendTo="body"
              autoDisplayFirst="false"
              id="shippingInfos"
            >
            </p-dropdown>
          </div>
        </ng-template>

        <ng-template pTemplate="footer">
          <div class="p-grid p-nogutter p-justify-between">
            <p-button styleClass="p-button-text" label="Cancel" (onClick)="hideDialog()" iconPos="left" icon="pi pi-times"></p-button>
            <p-button
              styleClass="p-button-text"
              label="Next"
              [disabled]="!selectedShippingInfo"
              (onClick)="nextPage(stepIndex)"
              icon="pi pi-angle-right"
              iconPos="right"
            ></p-button>
          </div>
        </ng-template>
      </p-card>
    </ng-container>

    <ng-container *ngIf="stepIndex === 1">
      <p-card>
        <ng-template pTemplate="content">
          <div class="p-field">
            <label for="customerName">Shipping Plan<span class="p-invalid"> *</span></label>
            <p-multiSelect
              appendTo="body"
              filterBy="label"
              placeholder="Please select a Shipping Plans"
              [filter]="true"
              [showClear]="true"
              [(ngModel)]="selectedShippingPlans"
              [options]="selectItems"
            >
            </p-multiSelect>
          </div>

          <div class="p-field">
            <label for="pickupDate">Pickup Date</label>
            <p-calendar
              id="pickupDate"
              [formControl]="shippingRequestForm.get('pickupDate')"
              appendTo="body"
              dateFormat="dd/mm/yy"
              showTime="true"
              hourFormat="24"
              [minDate]="minDate"
            ></p-calendar>
          </div>

          <div class="p-field">
            <label for="notes">Notes</label>
            <textarea id="notes" pInputTextarea [rows]="3" [formControl]="shippingRequestForm.get('notes')"></textarea>
          </div>
        </ng-template>

        <ng-template pTemplate="footer">
          <div class="p-grid p-nogutter p-justify-between">
            <p-button styleClass="p-button-text" label="Cancel" (onClick)="hideDialog()" iconPos="left" icon="pi pi-times"></p-button>
            <p-button styleClass="p-button-text" label="Next" (onClick)="nextPage(stepIndex)" icon="pi pi-angle-right" iconPos="right"></p-button>
          </div>
        </ng-template>
      </p-card>
    </ng-container>

    <ng-ncontainer *ngIf="stepIndex === 2">
      <p-card>
        <ng-template pTemplate="content">
          <p-table
            #productsDataTable
            dataKey="id"
            [columns]="productCols"
            [value]="selectedProducts"
            [globalFilterFields]="productFields"
            [(selection)]="selectedProducts"
            [paginator]="true"
            [rows]="10"
            scrollHeight="350px"
          >
            <ng-template pTemplate="caption">
              <div class="p-d-flex p-ai-center p-jc-between">
                <h5 class="p-m-0">{{ 'Products' | uppercase }}</h5>
                <div class="p-input-icon-left shipping-request-create__search">
                  <i class="pi pi-search"></i>
                  <input pInputText type="text" (input)="productsDataTable.filterGlobal($event.target.value, 'contains')" placeholder="Search..." />
                </div>
              </div>
            </ng-template>

            <ng-template pTemplate="colgroup" let-columns>
              <colgroup>
                <col [style.width.px]="col.width" *ngFor="let col of columns" />
              </colgroup>
            </ng-template>

            <ng-template pTemplate="header" let-columns>
              <tr>
                <ng-container *ngFor="let col of columns">
                  <ng-container [ngSwitch]="col.type">
                    <ng-container *ngSwitchCase="TypeColumn.CheckBoxColumn">
                      <th>
                        <p-tableHeaderCheckbox [disabled]="true"></p-tableHeaderCheckbox>
                      </th>
                    </ng-container>
                    <ng-container *ngSwitchDefault>
                      <th [pSortableColumn]="col.field">
                        {{ col.header }}
                        <ng-container *ngIf="col.field">
                          <p-sortIcon [field]="col.field"></p-sortIcon>
                        </ng-container>
                      </th>
                    </ng-container>
                  </ng-container>
                </ng-container>
              </tr>
            </ng-template>

            <ng-template pTemplate="body" let-product let-columns="columns">
              <tr>
                <td *ngFor="let col of columns">
                  <ng-container [ngSwitch]="col.type">
                    <ng-container *ngSwitchCase="TypeColumn.CheckBoxColumn">
                      <p-tableCheckbox [disabled]="true" [value]="product"></p-tableCheckbox>
                    </ng-container>
                    <ng-container *ngSwitchCase="TypeColumn.DateColumn">
                      {{ product[col.field] | date: 'dd/MM/yyyy' }}
                    </ng-container>
                    <ng-container *ngSwitchCase="TypeColumn.SubFieldColumn">
                      {{ product[col.field][col.subField] }}
                    </ng-container>
                    <ng-container *ngSwitchCase="TypeColumn.NormalColumn">
                      {{ product[col.field] }}
                    </ng-container>
                  </ng-container>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </ng-template>
        <ng-template pTemplate="footer">
          <div class="p-grid p-nogutter p-justify-between">
            <p-button styleClass="p-button-text" label="Back" (onClick)="prevPage()" iconPos="left" icon="pi pi-angle-left"></p-button>
            <p-button
              [disabled]="selectedProducts && selectedProducts.length === 0"
              styleClass="p-button-text"
              label="Next"
              (onClick)="nextPage(stepIndex)"
              icon="pi pi-angle-right"
              iconPos="right"
            ></p-button>
          </div>
        </ng-template>
      </p-card>
    </ng-ncontainer>

    <ng-container *ngIf="stepIndex === 3">
      <p-card>
        <ng-template pTemplate="content">
          <p-table [value]="shippingRequestDetails" [scrollable]="true">
            <ng-template pTemplate="colgroup" let-columns>
              <colgroup>
                <col style="width: 250px" />
                <col style="width: 250px" />
                <col style="width: 250px" />
                <col style="width: 250px" />
                <col style="width: 250px" />
                <col style="width: 250px" />
                <col style="width: 250px" />
                <col style="width: 250px" />
                <col style="width: 250px" />
              </colgroup>
            </ng-template>

            <ng-template pTemplate="header">
              <tr>
                <th class="p-text-center">Product Number</th>
                <th class="p-text-center">Product Line</th>
                <th class="p-text-center">Sales Order</th>
                <th class="p-text-center">Saleline Number</th>
                <th class="p-text-center">Purchase Order</th>
                <th class="p-text-center">Quantity<span class="p-invalid"> *</span></th>
                <th class="p-text-center">Price (USD)<span class="p-invalid"> *</span></th>
                <th class="p-text-center">Amount (USD)</th>
                <th class="p-text-center">Shipping Mode</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-item>
              <tr>
                <td>
                  {{ item?.product?.productNumber }}
                </td>

                <td>
                  {{ item?.productLine }}
                </td>

                <td>
                  {{ item?.salesOrder }}
                </td>

                <td>
                  {{ item?.salelineNumber }}
                </td>

                <td>
                  {{ item?.purchaseOrder }}
                </td>

                <td class="p-text-center">
                  {{ item?.quantity | number }}
                </td>

                <td class="p-text-center">
                  {{ item?.price | number: '1.1-5' }}
                </td>

                <td class="p-text-center">
                  {{ item?.amount | number: '1.1-5' }}
                </td>

                <td>
                  {{ item?.shippingMode }}
                </td>
              </tr>
            </ng-template>
          </p-table>
        </ng-template>
        <ng-template pTemplate="footer">
          <div class="p-grid p-nogutter p-justify-between">
            <p-button styleClass="p-button-text" label="Back" (onClick)="prevPage()" iconPos="left" icon="pi pi-angle-left"></p-button>
            <p-button styleClass="p-button-text" label="Next" (onClick)="onSubmit()" icon="pi pi-angle-right" iconPos="right"></p-button>
          </div>
        </ng-template>
      </p-card>
    </ng-container>
  </ng-template>
</p-dialog>
