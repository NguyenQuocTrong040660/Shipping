<p-dialog [closeOnEscape]="true" [position]="'right'" [header]="titleDialog" styleClass="p-fluid w-83" [modal]="true" [(visible)]="isShowDialog" (onHide)="hideDialog()">
  <ng-template pTemplate="content">
    <p-steps [model]="stepItems" [activeIndex]="stepIndex"></p-steps>

    <ng-container *ngIf="stepIndex === 0">
      <p-card>
        <ng-template pTemplate="content">
          <form [formGroup]="shippingPlanForm">
            <div class="p-grid p-fluid">
              <div class="p-col-12">
                <div class="p-field">
                  <label for="customerName">Customer Name<span class="p-invalid"> *</span></label>
                  <input
                    [ngClass]="{ 'ng-dirty': customerNameControl.invalid && (customerNameControl.dirty || customerNameControl.touched) }"
                    pInputText
                    id="customerName"
                    [formControl]="customerNameControl"
                    type="text"
                  />
                  <ng-container *ngIf="customerNameControl.invalid && (customerNameControl.dirty || customerNameControl.touched)">
                    <small class="p-invalid p-error">Please specify a customer name</small>
                  </ng-container>
                </div>
              </div>

              <div class="p-col-12">
                <div class="p-field">
                  <label for="salelineNumber">Saleline Number<span class="p-invalid"> *</span></label>

                  <input
                    [ngClass]="{ 'ng-dirty': salelineNumberControl.invalid && (salelineNumberControl.dirty || salelineNumberControl.touched) }"
                    pInputText
                    id="salelineNumber"
                    [formControl]="salelineNumberControl"
                    type="text"
                  />

                  <ng-container *ngIf="salelineNumberControl.invalid && (salelineNumberControl.dirty || salelineNumberControl.touched)">
                    <small class="p-invalid p-error">Please specify a Saleline Number</small>
                  </ng-container>
                </div>
              </div>

              <div class="p-col-6">
                <div class="p-field">
                  <label for="shippingMode">Purchase Order<span class="p-invalid"> *</span></label>
                  <input
                    [ngClass]="{ 'ng-dirty': purchaseOrderControl.invalid && (purchaseOrderControl.dirty || purchaseOrderControl.touched) }"
                    pInputText
                    id="shippingMode"
                    [formControl]="purchaseOrderControl"
                    type="text"
                  />

                  <ng-container *ngIf="purchaseOrderControl.invalid && (purchaseOrderControl.dirty || purchaseOrderControl.touched)">
                    <small class="p-invalid p-error">Please specify a purchase order</small>
                  </ng-container>
                </div>
              </div>

              <div class="p-col-6">
                <div class="p-field">
                  <label for="shippingDate">Shipping Date<span class="p-invalid"> *</span></label>
                  <p-calendar
                    [ngClass]="{ 'ng-dirty': shippingDateControl.invalid && (shippingDateControl.dirty || shippingDateControl.touched) }"
                    id="shippingDate"
                    [formControl]="shippingDateControl"
                    appendTo="body"
                    [minDate]="minDate"
                  ></p-calendar>

                  <ng-container *ngIf="shippingDateControl.invalid && (shippingDateControl.dirty || shippingDateControl.touched)">
                    <small class="p-invalid p-error">Please select shipping date</small>
                  </ng-container>
                </div>
              </div>

              <div class="p-col-12">
                <div class="p-field">
                  <label for="salesOrder">Sales Order<span class="p-invalid"> *</span></label>
                  <input
                    [ngClass]="{ 'ng-dirty': salesOrderControl.invalid && (salesOrderControl.dirty || salesOrderControl.touched) }"
                    pInputText
                    id="salesOrder"
                    [formControl]="salesOrderControl"
                    type="text"
                  />
                  <ng-container *ngIf="salesOrderControl.invalid && (salesOrderControl.dirty || salesOrderControl.touched)">
                    <small class="p-invalid p-error">Please specify a Sales Order</small>
                  </ng-container>
                </div>
              </div>

              <div class="p-col-6">
                <div class="p-field">
                  <label for="shipToControl">Ship To<span class="p-invalid"> *</span></label>
                  <input
                    [ngClass]="{ 'ng-dirty': shipToControl.invalid && (shipToControl.dirty || shipToControl.touched) }"
                    pInputText
                    id="shipToControl"
                    [formControl]="shipToControl"
                    type="text"
                  />

                  <ng-container *ngIf="shipToControl.invalid && (shipToControl.dirty || shipToControl.touched)">
                    <small class="p-invalid p-error">Please specify a ship to input</small>
                  </ng-container>
                </div>
              </div>

              <div class="p-col-6">
                <div class="p-field">
                  <label for="shipToAddressControl">Ship To Address<span class="p-invalid"> *</span></label>
                  <input
                    [ngClass]="{ 'ng-dirty': shipToAddressControl.invalid && (shipToAddressControl.dirty || shipToAddressControl.touched) }"
                    pInputText
                    id="shipToAddressControl"
                    [formControl]="shipToAddressControl"
                    type="text"
                  />

                  <ng-container *ngIf="shipToAddressControl.invalid && (shipToAddressControl.dirty || shipToAddressControl.touched)">
                    <small class="p-invalid p-error">Please specify a ship to address</small>
                  </ng-container>
                </div>
              </div>

              <div class="p-col-6">
                <div class="p-field">
                  <label for="billToControl">Bill To<span class="p-invalid"> *</span></label>
                  <input
                    [ngClass]="{ 'ng-dirty': billToControl.invalid && (billToControl.dirty || billToControl.touched) }"
                    pInputText
                    id="billToControl"
                    [formControl]="billToControl"
                    type="text"
                  />

                  <ng-container *ngIf="billToControl.invalid && (billToControl.dirty || billToControl.touched)">
                    <small class="p-invalid p-error">Please specify a bill to input</small>
                  </ng-container>
                </div>
              </div>

              <div class="p-col-6">
                <div class="p-field">
                  <label for="billToAddressControl">Bill To Address<span class="p-invalid"> *</span></label>
                  <input
                    [ngClass]="{ 'ng-dirty': billToAddressControl.invalid && (billToAddressControl.dirty || billToAddressControl.touched) }"
                    pInputText
                    id="billToAddressControl"
                    [formControl]="billToAddressControl"
                    type="text"
                  />

                  <ng-container *ngIf="billToAddressControl.invalid && (billToAddressControl.dirty || billToAddressControl.touched)">
                    <small class="p-invalid p-error">Please specify a bill to address</small>
                  </ng-container>
                </div>
              </div>

              <div class="p-col-6">
                <div class="p-field">
                  <label for="accountNumberControl">Account Number<span class="p-invalid"> *</span></label>
                  <input
                    [ngClass]="{ 'ng-dirty': accountNumberControl.invalid && (accountNumberControl.dirty || accountNumberControl.touched) }"
                    [formControl]="accountNumberControl"
                    id="accountNumberControl"
                    pInputText
                    type="text"
                  />

                  <ng-container *ngIf="accountNumberControl.invalid && (accountNumberControl.dirty || accountNumberControl.touched)">
                    <small class="p-invalid p-error">Please specify a account number</small>
                  </ng-container>
                </div>
              </div>

              <div class="p-col-6">
                <div class="p-field">
                  <label for="productLineControl">Product Line<span class="p-invalid"> *</span></label>
                  <p-inputNumber
                    [ngClass]="{ 'ng-dirty': productLineControl.invalid && (productLineControl.dirty || productLineControl.touched) }"
                    id="productLineControl"
                    [formControl]="productLineControl"
                  >
                  </p-inputNumber>

                  <ng-container *ngIf="productLineControl.invalid && (productLineControl.dirty || productLineControl.touched)">
                    <small class="p-invalid p-error">Please specify a product line</small>
                  </ng-container>
                </div>
              </div>

              <div class="p-col-12">
                <div class="p-field">
                  <label for="notes">Notes</label>
                  <textarea id="notes" pInputTextarea [rows]="3" [formControl]="notesControl"></textarea>
                </div>
              </div>
            </div>
          </form>
        </ng-template>

        <ng-template pTemplate="footer">
          <div class="p-grid p-nogutter p-justify-between">
            <p-button styleClass="p-button-text" label="Cancel" (onClick)="hideDialog()" iconPos="left" icon="pi pi-times"></p-button>
            <p-button
              [disabled]="shippingPlanForm.invalid"
              styleClass="p-button-text"
              label="Next"
              (onClick)="nextPage(stepIndex)"
              icon="pi pi-angle-right"
              iconPos="right"
            ></p-button>
          </div>
        </ng-template>
      </p-card>
    </ng-container>

    <ng-container *ngIf="stepIndex === 1">
      <p-card>
        <ng-template pTemplate="content">
          <p-table dataKey="id" [columns]="productCols" [value]="products" [(selection)]="selectedProduct" [paginator]="true" [rows]="10" scrollHeight="350px">
            <ng-template pTemplate="colgroup" let-columns>
              <colgroup>
                <col [style.width.px]="col.width" *ngFor="let col of columns" />
              </colgroup>
            </ng-template>

            <ng-template pTemplate="header" let-columns>
              <tr>
                <ng-container *ngFor="let col of columns">
                  <ng-container [ngSwitch]="col.type">
                    <ng-container *ngSwitchCase="TypeColumn.CheckBoxColumn">
                      <th></th>
                    </ng-container>
                    <ng-container *ngSwitchDefault>
                      <th [pSortableColumn]="col.field">
                        {{ col.header }}
                        <ng-container *ngIf="col.field">
                          <p-sortIcon [field]="col.field"></p-sortIcon>
                        </ng-container>
                      </th>
                    </ng-container>
                  </ng-container>
                </ng-container>
              </tr>
            </ng-template>

            <ng-template pTemplate="body" let-product let-columns="columns">
              <tr>
                <td *ngFor="let col of columns">
                  <ng-container [ngSwitch]="col.type">
                    <ng-container *ngSwitchCase="TypeColumn.CheckBoxColumn">
                      <p-tableRadioButton [value]="product"></p-tableRadioButton>
                    </ng-container>
                    <ng-container *ngSwitchCase="TypeColumn.DateColumn">
                      {{ product[col.field] | date: 'dd/MM/yyyy' }}
                    </ng-container>
                    <ng-container *ngSwitchCase="TypeColumn.SubFieldColumn">
                      {{ product[col.field][col.subField] }}
                    </ng-container>
                    <ng-container *ngSwitchCase="TypeColumn.NormalColumn">
                      {{ product[col.field] }}
                    </ng-container>
                  </ng-container>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </ng-template>
        <ng-template pTemplate="footer">
          <div class="p-grid p-nogutter p-justify-between">
            <p-button styleClass="p-button-text" label="Back" (onClick)="prevPage()" iconPos="left" icon="pi pi-angle-left"></p-button>
            <p-button
              [disabled]="selectedProducts && selectedProducts.length === 0"
              styleClass="p-button-text"
              label="Next"
              (onClick)="nextPage(stepIndex)"
              icon="pi pi-angle-right"
              iconPos="right"
            ></p-button>
          </div>
        </ng-template>
      </p-card>
    </ng-container>

    <ng-container *ngIf="stepIndex === 2">
      <p-card>
        <ng-template pTemplate="content">
          <p-table [value]="productDetails" dataKey="id" editMode="row">
            <ng-template pTemplate="header">
              <tr>
                <th class="p-text-center">Product Number</th>
                <th class="p-text-center">Description</th>
                <th class="p-text-center">Qty/ Pkg</th>
                <th class="p-text-center">Quantity<span class="p-invalid"> *</span></th>
                <th class="p-text-center">Price (USD)<span class="p-invalid"> *</span></th>
                <th class="p-text-center">Amount (USD)</th>
                <th class="p-text-center">Shipping Mode</th>
                <th style="width: 10rem"></th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-item let-editing="editing" let-ri="rowIndex">
              <tr [pEditableRow]="item">
                <td>
                  {{ item?.productNumber }}
                </td>
                <td>
                  {{ item?.productName }}
                </td>

                <td class="p-text-center">
                  {{ item?.qtyPerPackage }}
                </td>

                <td class="p-text-center">
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <p-inputNumber [(ngModel)]="item.quantity" required></p-inputNumber>
                    </ng-template>
                    <ng-template pTemplate="output">
                      {{ item?.quantity | number }}
                    </ng-template>
                  </p-cellEditor>
                </td>
                <td class="p-text-center">
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <p-inputNumber [(ngModel)]="item.price" required mode="decimal" required></p-inputNumber>
                    </ng-template>
                    <ng-template pTemplate="output">
                      {{ item?.price | number: '1.1-5' }}
                    </ng-template>
                  </p-cellEditor>
                </td>
                <td class="p-text-center">
                  {{ item?.amount | number: '1.1-5' }}
                </td>

                <td class="p-text-center">
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <input type="text" pInputText [(ngModel)]="item.shippingMode" />
                    </ng-template>
                    <ng-template pTemplate="output">
                      {{ item?.shippingMode }}
                    </ng-template>
                  </p-cellEditor>
                </td>

                <td class="p-text-center">
                  <button
                    *ngIf="!editing"
                    pButton
                    pRipple
                    type="button"
                    pInitEditableRow
                    icon="pi pi-pencil"
                    (click)="onRowEditInit(item)"
                    class="p-button-rounded p-button-text"
                  ></button>

                  <button
                    *ngIf="editing"
                    pButton
                    pRipple
                    type="button"
                    pSaveEditableRow
                    icon="pi pi-check"
                    [disabled]="!item.quantity || !item.price"
                    (click)="onRowEditSave(item)"
                    class="p-button-rounded p-button-text p-button-success p-mr-2"
                  ></button>
                  <button
                    *ngIf="editing"
                    pButton
                    pRipple
                    type="button"
                    pCancelEditableRow
                    icon="pi pi-times"
                    (click)="onRowEditCancel(item, ri)"
                    class="p-button-rounded p-button-text p-button-danger"
                  ></button>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </ng-template>
        <ng-template pTemplate="footer">
          <div class="p-grid p-nogutter p-justify-between">
            <p-button styleClass="p-button-text" label="Back" (onClick)="prevPage()" iconPos="left" icon="pi pi-angle-left"></p-button>
            <p-button
              [disabled]="!allowMoveToCompleteStep(productDetails)"
              styleClass="p-button-text"
              label="Next"
              (onClick)="nextPage(stepIndex)"
              icon="pi pi-angle-right"
              iconPos="right"
            ></p-button>
          </div>
        </ng-template>
      </p-card>
    </ng-container>

    <ng-container *ngIf="stepIndex === 3">
      <p-card>
        <ng-template pTemplate="content">
          <p-table dataKey="id" [value]="productDetails">
            <ng-template pTemplate="header" let-columns>
              <tr>
                <th class="p-text-center">Product Number</th>
                <th class="p-text-center">Description</th>
                <th class="p-text-center">Qty/ Pkg</th>
                <th class="p-text-center">Quantity</th>
                <th class="p-text-center">Price (USD)</th>
                <th class="p-text-center">Amount (USD)</th>
              </tr>
            </ng-template>

            <ng-template pTemplate="body" let-item>
              <tr>
                <td>
                  {{ item?.productNumber }}
                </td>

                <td>
                  {{ item?.productName }}
                </td>

                <td class="p-text-center">
                  {{ item?.qtyPerPackage }}
                </td>

                <td class="p-text-center">
                  {{ item?.quantity | number }}
                </td>

                <td class="p-text-center">
                  {{ item?.price | number: '1.1-5' }}
                </td>

                <td class="p-text-center">
                  {{ item?.amount | number: '1.1-5' }}
                </td>
              </tr>
            </ng-template>
          </p-table>
        </ng-template>
        <ng-template pTemplate="footer">
          <div class="p-grid p-nogutter p-justify-between">
            <p-button styleClass="p-button-text" label="Back" (onClick)="prevPage()" iconPos="left" icon="pi pi-angle-left"></p-button>
            <p-button [disabled]="shippingPlanForm.invalid" styleClass="p-button-text" label="Confirm" (onClick)="onSubmit()" icon="pi pi-angle-right" iconPos="right"></p-button>
          </div>
        </ng-template>
      </p-card>
    </ng-container>
  </ng-template>
</p-dialog>
