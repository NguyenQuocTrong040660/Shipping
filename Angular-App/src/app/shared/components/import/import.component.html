<p-steps [model]="stepItems" [activeIndex]="stepIndex"></p-steps>

<div class="p-mt-4">
  <ng-container *ngIf="stepIndex === 0">
    <p-fileUpload
      #form
      name="files"
      [customUpload]="true"
      [showCancelButton]="false"
      [accept]="getAccessFile()"
      [maxFileSize]="getMaximumFile()"
      (uploadHandler)="uploadHandler($event, form)"
      (onError)="handleUploadError($event)"
    >
      <ng-template pTemplate="content">
        <ul *ngIf="uploadedFiles.length">
          <li *ngFor="let file of uploadedFiles">{{ file.name }} - {{ file.size }} bytes</li>
        </ul>
      </ng-template>
    </p-fileUpload>
  </ng-container>

  <ng-container *ngIf="stepIndex === 1">
    <p-card>
      <ng-template pTemplate="content">
        <ng-container [ngSwitch]="typeImport">
          <ng-container *ngSwitchCase="TemplateType.Product">
            <p-table [value]="data">
              <ng-template pTemplate="header">
                <tr>
                  <th class="p-text-center">Product Number</th>
                  <th class="p-text-center">Description</th>
                  <th class="p-text-center">Qty/ Pkg</th>
                  <th class="p-text-center">Notes</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-item>
                <tr>
                  <td>
                    {{ item?.productNumber }}
                  </td>
                  <td>
                    {{ item?.productName }}
                  </td>
                  <td class="p-text-center">
                    {{ item?.qtyPerPackage }}
                  </td>
                  <td>
                    {{ item?.notes }}
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </ng-container>
          <ng-container *ngSwitchCase="TemplateType.WorkOrder">
            <p-table [value]="data">
              <ng-template pTemplate="header">
                <tr>
                  <th class="p-text-center">Id</th>
                  <th class="p-text-center">Product Number</th>
                  <th class="p-text-center">Quantity</th>
                  <th class="p-text-center">Notes</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-item>
                <tr>
                  <td>
                    {{ item?.workOrderId }}
                  </td>
                  <td>
                    {{ item?.productNumber }}
                  </td>
                  <td class="p-text-center">
                    {{ item?.quantity | number }}
                  </td>
                  <td>
                    {{ item?.notes }}
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </ng-container>
          <ng-container *ngSwitchCase="TemplateType.ShippingPlan">
            <p-table [value]="data">
              <ng-template pTemplate="header">
                <tr>
                  <th class="p-text-center">Reference Id</th>
                  <th class="p-text-center">Customer Name</th>
                  <th class="p-text-center">Purchase Order</th>
                  <th class="p-text-center">Sales ID</th>
                  <th class="p-text-center">Semline Number</th>
                  <th class="p-text-center">Product Number</th>
                  <th class="p-text-center">Quantity Order</th>
                  <th class="p-text-center">Sales Price</th>
                  <th class="p-text-center">Shipping Mode</th>
                  <th class="p-text-center">Shipping Date</th>
                  <th class="p-text-center">Notes</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-item>
                <tr>
                  <td>
                    {{ item?.shippingPlanId }}
                  </td>

                  <td>
                    {{ item?.customerName }}
                  </td>

                  <td>
                    {{ item?.purchaseOrder }}
                  </td>

                  <td>
                    {{ item?.salesID }}
                  </td>

                  <td>
                    {{ item?.semlineNumber }}
                  </td>

                  <td>
                    {{ item?.productNumber }}
                  </td>

                  <td class="p-text-center">
                    {{ item?.quantityOrder | number }}
                  </td>

                  <td class="p-text-center">
                    {{ item?.salesPrice | number }}
                  </td>

                  <td>
                    {{ item?.shippingMode }}
                  </td>

                  <td>
                    {{ item?.shippingDate | date: 'dd/MM/yyyy' }}
                  </td>

                  <td>
                    {{ item?.notes }}
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </ng-container>
        </ng-container>
      </ng-template>
      <ng-template pTemplate="footer">
        <div class="p-grid p-nogutter p-justify-between">
          <p-button styleClass="p-button-text" label="Back" (onClick)="prevPage()" iconPos="left" icon="pi pi-angle-left"></p-button>
          <p-button styleClass="p-button-text" label="Next" (onClick)="nextPage(stepIndex)" icon="pi pi-angle-right" iconPos="right"></p-button>
        </div>
      </ng-template>
    </p-card>
  </ng-container>

  <ng-container *ngIf="stepIndex === 2">
    <p-card>
      <ng-template pTemplate="content">
        <ng-container [ngSwitch]="typeImport">
          <ng-container *ngSwitchCase="TemplateType.Product">
            <p-table [value]="dataValidated">
              <ng-template pTemplate="header">
                <tr>
                  <th class="p-text-center">Product Number</th>
                  <th class="p-text-center">Description</th>
                  <th class="p-text-center">Qty/ Pkg</th>
                  <th class="p-text-center">Notes</th>
                  <th class="p-text-center" [style.width.px]="120">Status</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-item>
                <tr [ngClass]="item?.valid ? '' : 'p-text-danger'">
                  <td>
                    {{ item?.productNumber }}
                  </td>
                  <td>
                    {{ item?.productName }}
                  </td>
                  <td class="p-text-center">
                    {{ item?.qtyPerPackage }}
                  </td>
                  <td>
                    {{ item?.notes }}
                  </td>
                  <td class="p-text-center">
                    <button
                      pButton
                      pRipple
                      [ngClass]="item?.valid ? 'p-button-success' : 'p-button-danger'"
                      type="button"
                      [icon]="item?.valid ? 'pi pi-check-circle' : 'pi pi-ban'"
                      class="p-button-rounded p-button-text"
                    ></button>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </ng-container>
          <ng-container *ngSwitchCase="TemplateType.WorkOrder">
            <p-table [value]="dataValidated">
              <ng-template pTemplate="header">
                <tr>
                  <th class="p-text-center">Id</th>
                  <th class="p-text-center">Product Number</th>
                  <th class="p-text-center">Quantity</th>
                  <th class="p-text-center">Notes</th>
                  <th class="p-text-center" [style.width.px]="120">Status</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-item>
                <tr [ngClass]="item?.valid ? '' : 'p-text-danger'">
                  <td>
                    {{ item?.workOrderId }}
                  </td>
                  <td>
                    {{ item?.productNumber }}
                  </td>
                  <td class="p-text-center">
                    {{ item?.quantity | number }}
                  </td>
                  <td>
                    {{ item?.notes }}
                  </td>
                  <td class="p-text-center">
                    <button
                      pButton
                      pRipple
                      [ngClass]="item?.valid ? 'p-button-success' : 'p-button-danger'"
                      type="button"
                      [icon]="item?.valid ? 'pi pi-check-circle' : 'pi pi-ban'"
                      class="p-button-rounded p-button-text"
                    ></button>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </ng-container>
          <ng-container *ngSwitchCase="TemplateType.ShippingPlan">
            <p-table [value]="dataValidated">
              <ng-template pTemplate="header">
                <tr>
                  <th class="p-text-center">Reference Id</th>
                  <th class="p-text-center">Customer Name</th>
                  <th class="p-text-center">Purchase Order</th>
                  <th class="p-text-center">Sales ID</th>
                  <th class="p-text-center">Semline Number</th>
                  <th class="p-text-center">Product Number</th>
                  <th class="p-text-center">Quantity Order</th>
                  <th class="p-text-center">Sales Price</th>
                  <th class="p-text-center">Shipping Mode</th>
                  <th class="p-text-center">Shipping Date</th>
                  <th class="p-text-center">Notes</th>
                  <th class="p-text-center" [style.width.px]="120">Status</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-item>
                <tr [ngClass]="item?.valid ? '' : 'p-text-danger'">
                  <td>
                    {{ item?.shippingPlanId }}
                  </td>

                  <td>
                    {{ item?.customerName }}
                  </td>
                  <td>
                    {{ item?.purchaseOrder }}
                  </td>
                  <td>
                    {{ item?.salesID }}
                  </td>
                  <td>
                    {{ item?.semlineNumber }}
                  </td>
                  <td>
                    {{ item?.productNumber }}
                  </td>
                  <td class="p-text-center">
                    {{ item?.quantityOrder | number }}
                  </td>
                  <td class="p-text-center">
                    {{ item?.salesPrice | number }}
                  </td>
                  <td>
                    {{ item?.shippingMode }}
                  </td>
                  <td>
                    {{ item?.shippingDate | date: 'dd/MM/yyyy' }}
                  </td>
                  <td>
                    {{ item?.notes }}
                  </td>
                  <td class="p-text-center">
                    <button
                      pButton
                      pRipple
                      [ngClass]="item?.valid ? 'p-button-success' : 'p-button-danger'"
                      type="button"
                      [icon]="item?.valid ? 'pi pi-check-circle' : 'pi pi-ban'"
                      class="p-button-rounded p-button-text"
                    ></button>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </ng-container>
        </ng-container>
      </ng-template>
      <ng-template pTemplate="footer">
        <div class="p-grid p-nogutter p-justify-between">
          <p-button styleClass="p-button-text" label="Back" (onClick)="prevPage()" iconPos="left" icon="pi pi-angle-left"></p-button>
          <p-button styleClass="p-button-text" label="Next" (onClick)="nextPage(stepIndex)" icon="pi pi-angle-right" iconPos="right"></p-button>
        </div>
      </ng-template>
    </p-card>
  </ng-container>

  <ng-container *ngIf="stepIndex === 3">
    <p-card>
      <ng-template pTemplate="content">
        <ng-container [ngSwitch]="typeImport">
          <ng-container *ngSwitchCase="TemplateType.Product">
            <div class="p-mb-4">Some records have been failed to import:</div>
            <p-table [value]="failedToImportItems">
              <ng-template pTemplate="header">
                <tr>
                  <th class="p-text-center">Product Number</th>
                  <th class="p-text-center">Description</th>
                  <th class="p-text-center">Qty/ Pkg</th>
                  <th class="p-text-center">Notes</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-item>
                <tr>
                  <td>
                    {{ item?.productNumber }}
                  </td>
                  <td>
                    {{ item?.productName }}
                  </td>
                  <td class="p-text-center">
                    {{ item?.qtyPerPackage }}
                  </td>
                  <td>
                    {{ item?.notes }}
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </ng-container>
          <ng-container *ngSwitchCase="TemplateType.WorkOrder">
            <div class="p-mb-4">Some records have been failed to import:</div>
            <p-table [value]="failedToImportItems">
              <ng-template pTemplate="header">
                <tr>
                  <th class="p-text-center">Id</th>
                  <th class="p-text-center">Product Number</th>
                  <th class="p-text-center">Quantity</th>
                  <th class="p-text-center">Notes</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-item>
                <tr>
                  <td>
                    {{ item?.workOrderId }}
                  </td>
                  <td>
                    {{ item?.productNumber }}
                  </td>
                  <td class="p-text-center">
                    {{ item?.quantity | number }}
                  </td>
                  <td>
                    {{ item?.notes }}
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </ng-container>
          <ng-container *ngSwitchCase="TemplateType.ShippingPlan">
            <div class="p-mb-4">The records have been failed to import</div>
            <p-table [value]="failedToImportItems">
              <ng-template pTemplate="header">
                <tr>
                  <th class="p-text-center">Reference Id</th>
                  <th class="p-text-center">Customer Name</th>
                  <th class="p-text-center">Purchase Order</th>
                  <th class="p-text-center">Sales ID</th>
                  <th class="p-text-center">Semline Number</th>
                  <th class="p-text-center">Product Number</th>
                  <th class="p-text-center">Quantity Order</th>
                  <th class="p-text-center">Sales Price</th>
                  <th class="p-text-center">Shipping Mode</th>
                  <th class="p-text-center">Shipping Date</th>
                  <th class="p-text-center">Notes</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-item>
                <tr>
                  <td>
                    {{ item?.shippingPlanId }}
                  </td>
                  <td>
                    {{ item?.customerName }}
                  </td>
                  <td>
                    {{ item?.purchaseOrder }}
                  </td>
                  <td>
                    {{ item?.salesID }}
                  </td>
                  <td>
                    {{ item?.semlineNumber }}
                  </td>
                  <td>
                    {{ item?.productNumber }}
                  </td>
                  <td class="p-text-center">
                    {{ item?.quantityOrder | number }}
                  </td>
                  <td class="p-text-center">
                    {{ item?.salesPrice | number }}
                  </td>
                  <td>
                    {{ item?.shippingMode }}
                  </td>
                  <td>
                    {{ item?.shippingDate | date: 'dd/MM/yyyy' }}
                  </td>
                  <td>
                    {{ item?.notes }}
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </ng-container>
        </ng-container>
      </ng-template>

      <ng-template pTemplate="footer">
        <div class="p-grid p-nogutter p-justify-center">
          Total items completed:&nbsp;<span class="p-text-bold">{{ itemCompleted }} / {{ data.length }}</span>
        </div>

        <div class="p-grid p-nogutter p-justify-end">
          <p-button styleClass="p-button-text" label="Complete" (onClick)="nextPage(stepIndex)" icon="pi pi-angle-right" iconPos="right"></p-button>
        </div>
      </ng-template>
    </p-card>
  </ng-container>
</div>
